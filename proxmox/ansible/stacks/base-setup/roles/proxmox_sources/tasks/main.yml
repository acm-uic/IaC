---
- name: Correct Proxmox VE Sources
  copy:
    dest: /etc/apt/sources.list
    content: |
      deb http://deb.debian.org/debian bookworm main contrib
      deb http://deb.debian.org/debian bookworm-updates main contrib
      deb http://security.debian.org/debian-security bookworm-security main contrib
    backup: true
  when: correct_sources | bool
  tags:
    - sources
    - apt

- name: Configure APT to suppress firmware warnings
  copy:
    dest: /etc/apt/apt.conf.d/no-bookworm-firmware.conf
    content: 'APT::Get::Update::SourceListWarnings::NonFreeFirmware "false";'
  when: correct_sources | bool
  tags:
    - sources
    - apt

- name: Disable pve-enterprise repository
  copy:
    dest: /etc/apt/sources.list.d/pve-enterprise.list
    content: |
      # deb https://enterprise.proxmox.com/debian/pve bookworm pve-enterprise
    backup: true
  when: disable_enterprise | bool
  tags:
    - sources
    - enterprise

- name: Enable pve-no-subscription repository
  copy:
    dest: /etc/apt/sources.list.d/pve-install-repo.list
    content: |
      deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription
    backup: true
  when: enable_no_subscription | bool
  tags:
    - sources
    - no-subscription

- name: Correct Ceph package repositories
  copy:
    dest: /etc/apt/sources.list.d/ceph.list
    content: |
      # deb https://enterprise.proxmox.com/debian/ceph-quincy bookworm enterprise
      # deb http://download.proxmox.com/debian/ceph-quincy bookworm no-subscription
      # deb https://enterprise.proxmox.com/debian/ceph-reef bookworm enterprise
      # deb http://download.proxmox.com/debian/ceph-reef bookworm no-subscription
    backup: true
  when: correct_ceph_sources | bool
  tags:
    - sources
    - ceph

- name: Add pvetest repository (disabled)
  copy:
    dest: /etc/apt/sources.list.d/pvetest-for-beta.list
    content: |
      # deb http://download.proxmox.com/debian/pve bookworm pvetest
    backup: true
  when: add_pvetest_repo | bool
  tags:
    - sources
    - pvetest